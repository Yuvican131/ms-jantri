/**
 * @fileOverview Firestore Security Rules for the application.
 *
 * Core Philosophy:
 * This ruleset prioritizes security by enforcing explicit authorization checks for all write operations and restricting read access where appropriate. Data validation is relaxed for rapid prototyping.
 *
 * Data Structure:
 * The Firestore database consists of four top-level collections: `clients`, `sheetLogs`, `declaredNumbers`, and `accounts`.
 *
 * Key Security Decisions:
 * - Public listing of `sheetLogs` is disallowed due to the potentially sensitive nature of the data.  Only authenticated users are allowed access.
 * - All write operations require authentication.
 * - Data validation is limited to essential authorization checks.  The full data shapes are not strictly enforced.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Secures the `clients` collection.
     * @path /clients/{clientId}
     * @allow (read, write) Authenticated user
     * @deny (read, write) Unauthenticated user
     * @principle Enforces authentication for all operations on client data.
     */
    match /clients/{clientId} {
      // Helper function to check if the user is signed in
      function isSignedIn() {
        return request.auth != null;
      }

      // Helper function to check if the user is the owner
      function isOwner(clientId) {
        return request.auth.uid == clientId;
      }

      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secures the `sheetLogs` collection.
     * @path /sheetLogs/{logId}
     * @allow (read) Authenticated user
     * @deny (read) Unauthenticated user or unauthorized user
     * @principle Enforces authentication for all read and write operations on sheet logs.
     */
    match /sheetLogs/{logId} {
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secures the `declaredNumbers` collection.
     * @path /declaredNumbers/{drawName}
     * @allow (read, write) Authenticated user
     * @deny (read, write) Unauthenticated user
     * @principle Enforces authentication for all operations on declared numbers.
     */
    match /declaredNumbers/{drawName} {
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secures the `accounts` collection.
     * @path /accounts/{accountId}
     * @allow (read, write) Authenticated user
     * @deny (read, write) Unauthenticated user
     * @principle Enforces authentication for all operations on account data.
     */
    match /accounts/{accountId} {
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }
  }
}